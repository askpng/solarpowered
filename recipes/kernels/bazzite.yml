modules:
  - type: dnf
    repos:
      cleanup: true
      copr:
        - bieszczaders/kernel-cachyos-addons  
    install:
      packages:
        - scx-scheds    
    remove:
      packages:
        - kernel
        - kernel-core
        - kernel-modules
        - kernel-modules-core
        - kernel-modules-extra

  - type: script
    snippets:
      - 'rm -drf /usr/lib/modules/*'

  - type: script
    scripts:
      - base/bazzite.sh
  
  - type: akmods
    base: bazzite
    install:
      - ryzen-smu
      - v4l2loopback
      - zenergy

  - type: script
    snippets:
      - echo ryzen-smu > /etc/modprobe.d/ryzen-smu.conf
      - echo v4l2loopbacl > /etc/modprobe.d/v4l2loopbacl.conf
      - echo zenergy > /etc/modprobe.d/zenergy.conf

  - type: initramfs

  - type: systemd
    system:
      enabled:
      - scx_loader.service